(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[243],{8021:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/front-end/testing/writing-tests",function(){return n(5523)}])},5523:function(e,t,n){"use strict";n.r(t),n.d(t,{__toc:function(){return d}});var s=n(3860),i=n(2836),a=n(7385),r=n(3834);n(5524);var o=n(4709);let d=[{depth:2,value:"1. Preparing a story with input conditions for the test",id:"1-preparing-a-story-with-input-conditions-for-the-test"},{depth:2,value:"2. Creating a test with a story rendered",id:"2-creating-a-test-with-a-story-rendered"},{depth:2,value:"3. Write test logic",id:"3-write-test-logic"},{depth:2,value:"4. Check and debug the test",id:"4-check-and-debug-the-test"}];function _createMdxContent(e){let t=Object.assign({h1:"h1",p:"p",a:"a",h2:"h2",br:"br",admin:"admin",pre:"pre",code:"code",span:"span",ul:"ul",li:"li"},(0,o.a)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{children:"Writing tests with Jest"}),"\n",(0,s.jsx)(t.p,{children:":::{important}\nTry to transfer as much testing as possible to snapshots. There is no need to manually create jest tests on hundreds of lines to make sure that after loading the data the component will display all the required fields. Such tests are replaced by a single snapshot that includes everything needed.\n:::"}),"\n",(0,s.jsx)(t.p,{children:"We only need jest tests if we want to test the component dynamically. Set the initial conditions, interact with the component, find out that the necessary changes were made after the interaction."}),"\n",(0,s.jsxs)(t.p,{children:["To achieve this we will use ",(0,s.jsx)(t.a,{href:"https://jestjs.io/docs/getting-started",children:"Jest"}),", ",(0,s.jsx)(t.a,{href:"https://testing-library.com/docs/react-testing-library/intro/",children:"React Testing Library"})," and ",(0,s.jsx)(t.a,{href:"./stories#adding-a-story-with-component-interaction",children:"storybook interactions"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Let's describe the typical functional integration test using the familiar EmployeeProfile component, ",(0,s.jsx)(t.a,{href:"./stories",children:"the stories for which we created in the last chapter"}),"."]}),"\n",(0,s.jsx)(t.p,{children:'Let\'s assume that after the user with admin privileges pressed the "Edit" button, a modal window for editing the profile is displayed, with an input with the name "position" and a "Save" button.\nLet\'s write a test to check that after changing the "position" value in the modal and pressing the "Save" button, the EmployeeProfile component will immediately start displaying the new position value.'}),"\n",(0,s.jsx)(t.h2,{id:"1-preparing-a-story-with-input-conditions-for-the-test",children:"1. Preparing a story with input conditions for the test"}),"\n",(0,s.jsx)(t.p,{children:":::{important}\nTry to transfer as much logic as possible from the tests to the stories, because the latter are much easier to debug visually.\n:::"}),"\n",(0,s.jsxs)(t.p,{children:["To prepare the component for testing, let's create a story in which the data we need is passed to the component. In our case this is the TUserRole.ADMIN user role.\nLet's also prepare the interaction with the play history function, which will wait for the \"Edit\" button to appear and press this button to call the modal window. This part is described in the chapter ",(0,s.jsx)(t.a,{href:"./stories#adding-a-story-with-component-interaction",children:"Writing stories"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"2-creating-a-test-with-a-story-rendered",children:"2. Creating a test with a story rendered"}),"\n",(0,s.jsxs)(t.p,{children:["Now create our test by placing it next to the component under test\n:::{code-block}",(0,s.jsx)(t.br,{}),"\n:emphasize-lines: 7\nfront/\n┗ @components/\n┣ EmployeeProfile/\n┃ ┣ index.ts\n┃ ┣ employee-profile.tsx\n┃ ┣ employee-profile.stories.tsx\n┃ ┗ employee-profile.spec.tsx\n┣ ...\n:::"]}),"\n",(0,s.jsx)(t.p,{children:"Storybook allows us to render the story as a test component.\nIn doing so, we can read its parameters, pass properties to it, and call its play function to initiate a pre-prepared interaction."}),"\n",(0,s.jsx)(t.p,{children:":::{code-block} typescript\n:caption: Interaction test around component's story calling play function to interact with underlying component\n:linenos:\nimport * as stories from './employee-profile.stories';\nconst { Admin } = composeStories(stories);"}),"\n",(0,s.jsxs)(t.p,{children:["describe('Should match snapshot', () => {\ntest('with edit modal opened', async () => {\n// render component's story",(0,s.jsx)(t.br,{}),"\nconst { container, baseElement } = render(",(0,s.jsx)(t.admin,{children:");"})]}),"\n",(0,s.jsx)(t.pre,{"data-language":"text","data-theme":"default",children:(0,s.jsxs)(t.code,{"data-language":"text","data-theme":"default",children:[(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    // perform interaction with testing component"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    await act(() => Admin.play({ canvasElement: container }));"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    // use React Testing Library to access visible DOM elements"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    await screen.findByText('Edit modal title');"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    // some test logic to be here"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"});"})})]})}),"\n",(0,s.jsx)(t.p,{children:"});\n:::"}),"\n",(0,s.jsx)(t.h2,{id:"3-write-test-logic",children:"3. Write test logic"}),"\n",(0,s.jsxs)(t.p,{children:["Now using all the power of ",(0,s.jsx)(t.a,{href:"https://testing-library.com/docs/react-testing-library/intro/",children:"React Testing Library"}),' we can find in our modal window input "position", enter data, close the window by clicking "Save" button and make sure that the component displays the new value of the position.']}),"\n",(0,s.jsx)(t.p,{children:":::{code-block} typescript\n:caption: Interaction test around component's story calling play function to interact with underlying component\n:linenos:"}),"\n",(0,s.jsx)(t.p,{children:"import {render, fireEvent} from '@testing-library/react'\nimport * as stories from './employee-profile.stories';\nconst { Admin } = composeStories(stories);"}),"\n",(0,s.jsxs)(t.p,{children:["describe('Should match snapshot', () => {\ntest('with edit modal opened', async () => {\n// render component's story",(0,s.jsx)(t.br,{}),"\nconst { container, baseElement, getByLabelText } = render(",(0,s.jsx)(t.admin,{children:");"})]}),"\n",(0,s.jsx)(t.pre,{"data-language":"text","data-theme":"default",children:(0,s.jsxs)(t.code,{"data-language":"text","data-theme":"default",children:[(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    // perform interaction with testing component"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    act(() => await Admin.play({ canvasElement: container }));"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    // use React Testing Library to access visible DOM elements"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    await screen.findByText('Edit modal title');"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:'    // find the "position" input in the modal window'})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    const input = getByLabelText('Position');"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    fireEvent.change(input, {target: {value: 'Senior Fullstack Developer'}})"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    "})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:'    // find the "save" button in the modal window '})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    const saveButton = getByText('Save');"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    "})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    // and click it"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    act(() => {"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"        await userEvent.click(saveButton);"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    });"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    // check that modal window disappeared"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    await waitFor(() => {"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"        expect(queryByText('Edit modal title')).not.toBeInTheDocument()"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    })"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    // and finally check that the new value displayed"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    expect(screen.getByText('Senior Fullstack Developer')).toBeInTheDocument();"})}),"\n",(0,s.jsx)(t.span,{className:"line",children:(0,s.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"});"})})]})}),"\n",(0,s.jsx)(t.p,{children:"});\n:::"}),"\n",(0,s.jsx)(t.h2,{id:"4-check-and-debug-the-test",children:"4. Check and debug the test"}),"\n",(0,s.jsx)(t.p,{children:"To quickly run test separately specify the test filename calling test script"}),"\n",(0,s.jsx)(t.p,{children:":::{code-block} console\nyarn test employee-profile.spec.tsx\n:::"}),"\n",(0,s.jsx)(t.p,{children:":::{seealso}"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://testing-library.com/docs/dom-testing-library/api-debugging/",children:"React Testing Library debugging"})}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://jestjs.io/docs/troubleshooting",children:"Jest troubleshooting"}),"\n:::"]}),"\n"]})]})}let c={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:t}=Object.assign({},(0,o.a)(),e.components);return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/front-end/testing/writing-tests.md",route:"/front-end/testing/writing-tests",pageMap:[{kind:"Meta",data:{"front-end":{title:"Front End"},about:{title:"About",type:"page"},contact:{title:"Contact ↗",type:"page",href:"https://twitter.com/shuding_",newWindow:!0},advanced:"Advanced",another:"Another",index:"Index"}},{kind:"MdxPage",name:"about",route:"/about"},{kind:"MdxPage",name:"advanced",route:"/advanced"},{kind:"MdxPage",name:"another",route:"/another"},{kind:"Folder",name:"front-end",route:"/front-end",children:[{kind:"Meta",data:{css:{title:"Css",theme:{typesetting:"article"}},react:{title:"React",theme:{typesetting:"article"}},links:"Links",plugins:"Plugins"}},{kind:"Folder",name:"css",route:"/front-end/css",children:[{kind:"MdxPage",name:"stylesheets",route:"/front-end/css/stylesheets"},{kind:"MdxPage",name:"tailwind-css",route:"/front-end/css/tailwind-css"},{kind:"MdxPage",name:"theme",route:"/front-end/css/theme"},{kind:"Meta",data:{stylesheets:"Stylesheets","tailwind-css":"Tailwind CSS",theme:"Theme"}}]},{kind:"MdxPage",name:"css",route:"/front-end/css"},{kind:"Folder",name:"data",route:"/front-end/data",children:[{kind:"Folder",name:"easy-peasy",route:"/front-end/data/easy-peasy",children:[{kind:"MdxPage",name:"best-practices",route:"/front-end/data/easy-peasy/best-practices"},{kind:"MdxPage",name:"data-storing",route:"/front-end/data/easy-peasy/data-storing"},{kind:"MdxPage",name:"index",route:"/front-end/data/easy-peasy"},{kind:"Meta",data:{"best-practices":"Best Practices","data-storing":"Data Storing",index:"Index"}}]},{kind:"MdxPage",name:"index",route:"/front-end/data"},{kind:"Folder",name:"react-query",route:"/front-end/data/react-query",children:[{kind:"MdxPage",name:"data-fetching",route:"/front-end/data/react-query/data-fetching"},{kind:"MdxPage",name:"index",route:"/front-end/data/react-query"},{kind:"MdxPage",name:"optimistic-updates",route:"/front-end/data/react-query/optimistic-updates"},{kind:"Meta",data:{"data-fetching":"Data Fetching",index:"Index","optimistic-updates":"Optimistic Updates"}}]},{kind:"Meta",data:{index:"Index"}}]},{kind:"Folder",name:"forms",route:"/front-end/forms",children:[{kind:"MdxPage",name:"custom-components",route:"/front-end/forms/custom-components"},{kind:"MdxPage",name:"index",route:"/front-end/forms"},{kind:"MdxPage",name:"validation",route:"/front-end/forms/validation"},{kind:"MdxPage",name:"writing-forms",route:"/front-end/forms/writing-forms"},{kind:"Meta",data:{"custom-components":"Custom Components",index:"Index",validation:"Validation","writing-forms":"Writing Forms"}}]},{kind:"MdxPage",name:"links",route:"/front-end/links"},{kind:"Folder",name:"overview",route:"/front-end/overview",children:[{kind:"MdxPage",name:"best-practices",route:"/front-end/overview/best-practices"},{kind:"MdxPage",name:"folder-structure",route:"/front-end/overview/folder-structure"},{kind:"MdxPage",name:"project-setup",route:"/front-end/overview/project-setup"},{kind:"Meta",data:{"best-practices":"Best Practices","folder-structure":"Folder Structure","project-setup":"Project Setup"}}]},{kind:"MdxPage",name:"plugins",route:"/front-end/plugins"},{kind:"Folder",name:"react",route:"/front-end/react",children:[{kind:"Meta",data:{index:"Introduction","best-practices":"Best Practices"}},{kind:"MdxPage",name:"best-practices",route:"/front-end/react/best-practices"},{kind:"MdxPage",name:"index",route:"/front-end/react"}]},{kind:"Folder",name:"testing",route:"/front-end/testing",children:[{kind:"MdxPage",name:"best-practices",route:"/front-end/testing/best-practices"},{kind:"MdxPage",name:"coverage",route:"/front-end/testing/coverage"},{kind:"MdxPage",name:"index",route:"/front-end/testing"},{kind:"MdxPage",name:"links",route:"/front-end/testing/links"},{kind:"MdxPage",name:"mocks",route:"/front-end/testing/mocks"},{kind:"MdxPage",name:"snapshots",route:"/front-end/testing/snapshots"},{kind:"MdxPage",name:"stories",route:"/front-end/testing/stories"},{kind:"MdxPage",name:"storybook",route:"/front-end/testing/storybook"},{kind:"MdxPage",name:"writing-tests",route:"/front-end/testing/writing-tests"},{kind:"Meta",data:{"best-practices":"Best Practices",coverage:"Coverage",index:"Index",links:"Links",mocks:"Mocks",snapshots:"Snapshots",stories:"Stories",storybook:"Storybook","writing-tests":"Writing Tests"}}]},{kind:"Folder",name:"typescript",route:"/front-end/typescript",children:[{kind:"MdxPage",name:"best-practices",route:"/front-end/typescript/best-practices"},{kind:"MdxPage",name:"index",route:"/front-end/typescript"},{kind:"Meta",data:{"best-practices":"Best Practices",index:"Index"}}]}]},{kind:"MdxPage",name:"front-end",route:"/front-end"},{kind:"MdxPage",name:"index",route:"/"}],flexsearch:{codeblocks:!0},title:"Writing tests with Jest",headings:d},pageNextRoute:"/front-end/testing/writing-tests",nextraLayout:a.ZP,themeConfig:r.Z};t.default=(0,i.j)(c)},3834:function(e,t,n){"use strict";var s=n(3860);n(1733);let i={logo:(0,s.jsx)("span",{children:"My Project"}),project:{link:"https://github.com/shuding/nextra-docs-template"},chat:{link:"https://discord.com"},docsRepositoryBase:"https://github.com/shuding/nextra-docs-template",footer:{text:"Nextra Docs Template"}};t.Z=i}},function(e){e.O(0,[774,37,888,179],function(){return e(e.s=8021)}),_N_E=e.O()}]);